# 2ì¼ì°¨: Main Processì™€ ì• í”Œë¦¬ì¼€ì´ì…˜ ìƒëª…ì£¼ê¸°

## í•™ìŠµ ëª©í‘œ
- Main Processì˜ ì—­í• ê³¼ ì±…ì„ì„ ì´í•´í•œë‹¤
- Electron ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ìƒëª…ì£¼ê¸°ë¥¼ í•™ìŠµí•œë‹¤
- main.ts íŒŒì¼ì˜ êµ¬ì¡°ë¥¼ ë¶„ì„í•œë‹¤
- BrowserWindowì™€ ìœˆë„ìš° ê´€ë¦¬ë¥¼ ì´í•´í•œë‹¤

## ì´ë¡  í•™ìŠµ

### Main Processì˜ í•µì‹¬ ì—­í• 

#### 1. ì• í”Œë¦¬ì¼€ì´ì…˜ ìƒëª…ì£¼ê¸° ê´€ë¦¬
- **ì‹œì‘(Start)**: ì•± ì´ˆê¸°í™” ë° ì„¤ì •
- **ì¤€ë¹„(Ready)**: Electronì´ ì™„ì „íˆ ë¡œë“œëœ ìƒíƒœ
- **ì¢…ë£Œ(Quit)**: ëª¨ë“  ìœˆë„ìš°ê°€ ë‹«íˆê³  ì•± ì¢…ë£Œ

#### 2. ìœˆë„ìš° ìƒì„± ë° ê´€ë¦¬
- **BrowserWindow ì¸ìŠ¤í„´ìŠ¤** ìƒì„±
- **ì›¹ ì½˜í…ì¸  ë¡œë”©** (HTML/React ì•±)
- **ìœˆë„ìš° ì´ë²¤íŠ¸ ì²˜ë¦¬** (ë‹«ê¸°, ìµœì†Œí™” ë“±)

#### 3. ì‹œìŠ¤í…œ í†µí•©
- **ì‹œìŠ¤í…œ íŠ¸ë ˆì´** ê´€ë¦¬
- **ë©”ë‰´ë°”** ì„¤ì •
- **íŒŒì¼ ì‹œìŠ¤í…œ** ì ‘ê·¼
- **OS ì•Œë¦¼** ë°œì†¡

#### 4. IPC í†µì‹  ê´€ë¦¬
- **Renderer Processì™€ì˜ í†µì‹ ** ì¤‘ê°œ
- **ë³´ì•ˆ ì •ì±…** ì ìš©
- **ë°ì´í„° ê²€ì¦** ë° ì²˜ë¦¬

### Electron ì•± ìƒëª…ì£¼ê¸° ì´ë²¤íŠ¸

```javascript
// ì£¼ìš” ìƒëª…ì£¼ê¸° ì´ë²¤íŠ¸ë“¤
app.whenReady()     // ì•±ì´ ì¤€ë¹„ë˜ì—ˆì„ ë•Œ
app.on('ready')     // ìœ„ì™€ ë™ì¼
app.on('activate')  // macOSì—ì„œ ë… í´ë¦­ ì‹œ
app.on('window-all-closed') // ëª¨ë“  ìœˆë„ìš°ê°€ ë‹«í˜”ì„ ë•Œ
app.on('before-quit')       // ì¢…ë£Œ ì „
app.on('will-quit')         // ì¢…ë£Œ ì§ì „
```

## ì½”ë“œ ë¶„ì„

### ìš°ë¦¬ í”„ë¡œì íŠ¸ì˜ main.ts êµ¬ì¡° ë¶„ì„

#### 1. í´ë˜ìŠ¤ ê¸°ë°˜ ì„¤ê³„ íŒ¨í„´

```typescript
class StreamerAlarmApp {
  private mainWindow: BrowserWindow | null = null;
  private tray: Tray | null = null;
  // ê°ì¢… ì„œë¹„ìŠ¤ë“¤ì„ private ë©¤ë²„ë¡œ ê´€ë¦¬
  private databaseManager: DatabaseManager;
  private monitoringService: MonitoringService;
  // ...
}
```

**ì„¤ê³„ ì¥ì :**
- **ìº¡ìŠí™”**: ìƒíƒœì™€ ë©”ì„œë“œë¥¼ í´ë˜ìŠ¤ ë‚´ë¶€ë¡œ ì€ë‹‰
- **ì¬ì‚¬ìš©ì„±**: ì„œë¹„ìŠ¤ë³„ë¡œ ë¶„ë¦¬ëœ ì±…ì„
- **ìœ ì§€ë³´ìˆ˜ì„±**: ëª…í™•í•œ êµ¬ì¡°ì™€ ì˜ì¡´ì„± ê´€ë¦¬

#### 2. ì„œë¹„ìŠ¤ ì§€í–¥ ì•„í‚¤í…ì²˜

```typescript
constructor() {
  // ì˜ì¡´ì„± ì£¼ì… íŒ¨í„´ ì‚¬ìš©
  this.databaseManager = new DatabaseManager();
  this.settingsService = new SettingsService(this.databaseManager);
  this.notificationService = new NotificationService(this.databaseManager);
  this.monitoringService = new MonitoringService(
    this.databaseManager,
    this.notificationService
  );
}
```

**íŒ¨í„´ ë¶„ì„:**
- **Dependency Injection**: ì„œë¹„ìŠ¤ ê°„ ì˜ì¡´ì„±ì„ ìƒì„±ìì—ì„œ ì£¼ì…
- **Single Responsibility**: ê° ì„œë¹„ìŠ¤ëŠ” í•˜ë‚˜ì˜ ì±…ì„ë§Œ ë‹´ë‹¹
- **Composition over Inheritance**: ìƒì†ë³´ë‹¤ëŠ” êµ¬ì„±ì„ í†µí•œ ê¸°ëŠ¥ í™•ì¥#### 3. Single Instance Lock íŒ¨í„´

```typescript
// ì¤‘ë³µ ì‹¤í–‰ ë°©ì§€ (Single Instance Lock)
const gotTheLock = app.requestSingleInstanceLock();

if (!gotTheLock) {
  console.log('âš ï¸ Application is already running. Exiting...');
  app.quit();
  return;
}
```

**ì™œ í•„ìš”í•œê°€?**
- **ì‹œìŠ¤í…œ ë¦¬ì†ŒìŠ¤ ë³´í˜¸**: ì¤‘ë³µ ì‹¤í–‰ìœ¼ë¡œ ì¸í•œ ë¦¬ì†ŒìŠ¤ ë‚­ë¹„ ë°©ì§€
- **ë°ì´í„° ì¶©ëŒ ë°©ì§€**: ê°™ì€ ë°ì´í„°ë² ì´ìŠ¤ì— ë™ì‹œ ì ‘ê·¼ ë°©ì§€
- **ì‚¬ìš©ì ê²½í—˜**: ì´ë¯¸ ì‹¤í–‰ ì¤‘ì¸ ì•±ì„ í¬ì»¤ìŠ¤ë¡œ ì „í™˜

#### 4. BrowserWindow ìƒì„±ê³¼ ì„¤ì •

```typescript
this.mainWindow = new BrowserWindow({
  width: 1200,
  height: 800,
  minWidth: 800,
  minHeight: 600,
  webPreferences: {
    nodeIntegration: false,        // ë³´ì•ˆ: Node.js ì§ì ‘ ì ‘ê·¼ ì°¨ë‹¨
    contextIsolation: true,        // ë³´ì•ˆ: ì»¨í…ìŠ¤íŠ¸ ê²©ë¦¬
    preload: path.join(__dirname, 'preload.js'), // Preload ìŠ¤í¬ë¦½íŠ¸
  },
  icon: path.join(__dirname, '../../assets/icon.png'),
  title: 'Streamer Alarm System',
  show: true,
});
```

**ë³´ì•ˆ ì„¤ì • ë¶„ì„:**
- `nodeIntegration: false`: ë Œë”ëŸ¬ì—ì„œ Node.js API ì§ì ‘ ì‚¬ìš© ê¸ˆì§€
- `contextIsolation: true`: ë©”ì¸ ì›”ë“œì™€ ê²©ë¦¬ëœ ì»¨í…ìŠ¤íŠ¸ ì‚¬ìš©
- `preload`: ì•ˆì „í•œ ë°©ì‹ìœ¼ë¡œ API ë…¸ì¶œ

#### 5. ê°œë°œ/í”„ë¡œë•ì…˜ í™˜ê²½ ë¶„ê¸°

```typescript
// ê°œë°œ/í”„ë¡œë•ì…˜ í™˜ê²½ì— ë”°ë¥¸ URL ë¡œë“œ
if (this.isDev) {
  this.mainWindow.loadURL('http://localhost:3000');
  this.mainWindow.webContents.openDevTools();
} else {
  this.mainWindow.loadFile(path.join(__dirname, 'index.html'));
}
```

**í™˜ê²½ë³„ ì°¨ì´ì :**
- **ê°œë°œ**: ì›¹íŒ© ê°œë°œ ì„œë²„ì—ì„œ ë¡œë”©, ê°œë°œì ë„êµ¬ ìë™ ì˜¤í”ˆ
- **í”„ë¡œë•ì…˜**: ë¡œì»¬ HTML íŒŒì¼ì—ì„œ ë¡œë”©, ìµœì í™”ëœ ì„±ëŠ¥

#### 6. ìœˆë„ìš° ì´ë²¤íŠ¸ ì²˜ë¦¬

```typescript
this.mainWindow.on('close', (event) => {
  if (this.shouldMinimizeToTray()) {
    event.preventDefault();      // ê¸°ë³¸ ë‹«ê¸° ë™ì‘ ì°¨ë‹¨
    this.mainWindow?.hide();     // íŠ¸ë ˆì´ë¡œ ìµœì†Œí™”
  }
});

this.mainWindow.on('closed', () => {
  this.mainWindow = null;        // ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ë°©ì§€
});
```

**ì´ë²¤íŠ¸ í•¸ë“¤ë§ íŒ¨í„´:**
- **Event Prevention**: ê¸°ë³¸ ë™ì‘ì„ ì°¨ë‹¨í•˜ê³  ì»¤ìŠ¤í…€ ë¡œì§ ì‹¤í–‰
- **Memory Management**: ìœˆë„ìš° ì¢…ë£Œ ì‹œ ì°¸ì¡° í•´ì œ
- **User Experience**: ì„¤ì •ì— ë”°ë¥¸ ë™ì‘ ë¶„ê¸°

## ì‹¤ìŠµ ì˜ˆì œ

### ì‹¤ìŠµ 1: Main Process ë¡œê·¸ ì¶”ì 

1. **ê°œë°œ ëª¨ë“œì—ì„œ ì•± ì‹¤í–‰:**
```bash
npm run dev
```

2. **ì½˜ì†”ì—ì„œ Main Process ë¡œê·¸ ê´€ì°°:**
```
Starting app initialization...
Electron app ready (Single Instance)
Database initialized successfully
Main window created successfully
Tray setup successfully
```

3. **ì´ˆê¸°í™” ìˆœì„œ ì´í•´:**
   - Single Instance Lock í™•ì¸
   - ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸°í™”
   - ë©”ì¸ ìœˆë„ìš° ìƒì„±
   - ì‹œìŠ¤í…œ íŠ¸ë ˆì´ ì„¤ì •

### ì‹¤ìŠµ 2: ìœˆë„ìš° ë™ì‘ í…ŒìŠ¤íŠ¸

1. **ìœˆë„ìš° ë‹«ê¸° ë²„íŠ¼ í´ë¦­ ê´€ì°°:**
   - ì„¤ì •ì— ë”°ë¼ íŠ¸ë ˆì´ë¡œ ìµœì†Œí™”ë˜ëŠ”ì§€ í™•ì¸
   - ì™„ì „íˆ ì¢…ë£Œë˜ëŠ”ì§€ í™•ì¸

2. **ì‹œìŠ¤í…œ íŠ¸ë ˆì´ ì•„ì´ì½˜ í™•ì¸:**
   - íŠ¸ë ˆì´ ì•„ì´ì½˜ì´ ë‚˜íƒ€ë‚˜ëŠ”ì§€ í™•ì¸
   - ìš°í´ë¦­ ë©”ë‰´ ë™ì‘ í™•ì¸

### ì‹¤ìŠµ 3: ì¤‘ë³µ ì‹¤í–‰ í…ŒìŠ¤íŠ¸

1. **ì²« ë²ˆì§¸ ì¸ìŠ¤í„´ìŠ¤ ì‹¤í–‰:**
```bash
npm start
```

2. **ë‘ ë²ˆì§¸ ì¸ìŠ¤í„´ìŠ¤ ì‹¤í–‰ ì‹œë„:**
```bash
npm start  # ë‹¤ë¥¸ í„°ë¯¸ë„ì—ì„œ
```

3. **ê²°ê³¼ ê´€ì°°:**
   - ë‘ ë²ˆì§¸ ì¸ìŠ¤í„´ìŠ¤ê°€ ìë™ìœ¼ë¡œ ì¢…ë£Œë˜ëŠ”ì§€ í™•ì¸
   - ì²« ë²ˆì§¸ ì¸ìŠ¤í„´ìŠ¤ê°€ í¬ì»¤ìŠ¤ë˜ëŠ”ì§€ í™•ì¸## ê³¼ì œ

### ê³¼ì œ 1: ìƒëª…ì£¼ê¸° ì´ë²¤íŠ¸ ì¶”ì 
main.tsì˜ `initialize()` ë©”ì„œë“œë¥¼ ë¶„ì„í•˜ì—¬ ë‹¤ìŒ ì§ˆë¬¸ì— ë‹µí•˜ì„¸ìš”:

1. **Single Instance Lockì€ ì–¸ì œ ì ìš©ë˜ëŠ”ê°€?**
2. **ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸°í™”ê°€ ì‹¤íŒ¨í•˜ë©´ ì•±ì´ ì¢…ë£Œë˜ëŠ”ê°€?**
3. **ë©”ì¸ ìœˆë„ìš° ìƒì„±ì´ ì‹¤íŒ¨í•˜ë©´ ì–´ë–»ê²Œ ë˜ëŠ”ê°€?**
4. **íŠ¸ë ˆì´ ì„¤ì •ì´ ì‹¤íŒ¨í•´ë„ ì•±ì€ ê³„ì† ì‹¤í–‰ë˜ëŠ”ê°€?**

### ê³¼ì œ 2: ìœˆë„ìš° ì„¤ì • ë¶„ì„
BrowserWindow ìƒì„± ì˜µì…˜ì„ ë¶„ì„í•˜ê³  ê°ê°ì˜ ì˜ë¯¸ë¥¼ ì„¤ëª…í•˜ì„¸ìš”:

```typescript
{
  width: 1200, height: 800,      // ì´ˆê¸° í¬ê¸°
  minWidth: 800, minHeight: 600, // ìµœì†Œ í¬ê¸°
  webPreferences: {
    nodeIntegration: false,
    contextIsolation: true,
    preload: path.join(__dirname, 'preload.js'),
  }
}
```

**ì§ˆë¬¸:**
1. **ì™œ nodeIntegrationì„ falseë¡œ ì„¤ì •í–ˆëŠ”ê°€?**
2. **contextIsolationì´ trueì¼ ë•Œì˜ ë³´ì•ˆ ì´ì ì€?**
3. **preload ìŠ¤í¬ë¦½íŠ¸ì˜ ì—­í• ì€ ë¬´ì—‡ì¸ê°€?**

### ê³¼ì œ 3: ì„œë¹„ìŠ¤ ì˜ì¡´ì„± ë‹¤ì´ì–´ê·¸ë¨ ê·¸ë¦¬ê¸°
main.tsì˜ constructorì—ì„œ ìƒì„±ë˜ëŠ” ì„œë¹„ìŠ¤ë“¤ì˜ ì˜ì¡´ì„±ì„ ë¶„ì„í•˜ì—¬ ë‹¤ì´ì–´ê·¸ë¨ì„ ê·¸ë ¤ë³´ì„¸ìš”:

```
DatabaseManager â†’ SettingsService
DatabaseManager â†’ NotificationService  
DatabaseManager + NotificationService â†’ MonitoringService
```

**ì¶”ê°€ ë¶„ì„:**
1. **ì™œ ì´ëŸ° ìˆœì„œë¡œ ì˜ì¡´ì„±ì´ êµ¬ì„±ë˜ì—ˆëŠ”ê°€?**
2. **ìˆœì„œë¥¼ ë°”ê¾¸ë©´ ì–´ë–¤ ë¬¸ì œê°€ ë°œìƒí• ê¹Œ?**

### ê³¼ì œ 4: ì‹¤ìŠµ - ê°„ë‹¨í•œ Main Process ìˆ˜ì •

**ì£¼ì˜: ì´ ê³¼ì œëŠ” ì‹¤ì œ ì½”ë“œë¥¼ ìˆ˜ì •í•˜ì§€ ë§ê³ , ë³„ë„ íŒŒì¼ì—ì„œ ì‹¤ìŠµí•˜ì„¸ìš”!**

ë‹¤ìŒê³¼ ê°™ì€ ê¸°ëŠ¥ì„ ì¶”ê°€í•œ ê°„ë‹¨í•œ main.tsë¥¼ ì‘ì„±í•´ë³´ì„¸ìš”:

1. **ìœˆë„ìš° íƒ€ì´í‹€ì— í˜„ì¬ ì‹œê°„ í‘œì‹œ**
2. **ì•± ì‹œì‘ ì‹œ ì½˜ì†”ì— í™˜ì˜ ë©”ì‹œì§€ ì¶œë ¥**
3. **ìœˆë„ìš° í¬ê¸° ë³€ê²½ ì‹œ ìƒˆë¡œìš´ í¬ê¸°ë¥¼ ì½˜ì†”ì— ì¶œë ¥**

```typescript
// íŒíŠ¸: ì´ëŸ° ì´ë²¤íŠ¸ë“¤ì„ í™œìš©í•´ë³´ì„¸ìš”
this.mainWindow.on('resize', () => {
  const bounds = this.mainWindow.getBounds();
  console.log(`Window resized: ${bounds.width}x${bounds.height}`);
});

// íƒ€ì´í‹€ ì—…ë°ì´íŠ¸
setInterval(() => {
  const now = new Date().toLocaleTimeString();
  this.mainWindow.setTitle(`My App - ${now}`);
}, 1000);
```

## ì¶”ê°€ í•™ìŠµ ìë£Œ

### ê³µì‹ ë¬¸ì„œ
- [BrowserWindow API](https://www.electronjs.org/docs/latest/api/browser-window)
- [App ìƒëª…ì£¼ê¸° ì´ë²¤íŠ¸](https://www.electronjs.org/docs/latest/api/app#events)
- [í”„ë¡œì„¸ìŠ¤ ëª¨ë¸](https://www.electronjs.org/docs/latest/tutorial/process-model)

### ì¶”ì²œ ì½ì„ê±°ë¦¬
- [Electron ë³´ì•ˆ ëª¨ë²” ì‚¬ë¡€](https://www.electronjs.org/docs/latest/tutorial/security)
- [Context Isolation](https://www.electronjs.org/docs/latest/tutorial/context-isolation)

### ë‹¤ìŒ í•™ìŠµ ì˜ˆê³ 
**3ì¼ì°¨ì—ì„œëŠ” Renderer Processì™€ React í†µí•©ì„ í•™ìŠµí•©ë‹ˆë‹¤. `src/renderer/App.tsx`ë¥¼ ë¶„ì„í•˜ë©° UI ì»´í¬ë„ŒíŠ¸ì™€ ìƒíƒœ ê´€ë¦¬ì— ëŒ€í•´ ì•Œì•„ë´…ë‹ˆë‹¤.**

---
*ğŸ¯ í•™ìŠµ íŒ: Main ProcessëŠ” Electron ì•±ì˜ ë°±ë³¸ì…ë‹ˆë‹¤. ê° ì„œë¹„ìŠ¤ì˜ ì—­í• ê³¼ ì´ˆê¸°í™” ìˆœì„œë¥¼ ëª…í™•íˆ ì´í•´í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤!*