# ğŸ“¡ 11ì¼ì°¨: ì™¸ë¶€ APIì™€ ì›¹ ìŠ¤í¬ë˜í•‘

> **í•™ìŠµ ëª©í‘œ**: Playwrightë¥¼ í™œìš©í•œ ì›¹ ìŠ¤í¬ë˜í•‘ê³¼ ë¸Œë¼ìš°ì € í’€ ê´€ë¦¬, ì‹¤ì‹œê°„ ë°ì´í„° ìˆ˜ì§‘ ì‹œìŠ¤í…œ êµ¬í˜„

---

## ğŸ¯ í•™ìŠµ ëª©í‘œ

### í•µì‹¬ ëª©í‘œ
- Playwright ê¸°ë°˜ ì›¹ ìŠ¤í¬ë˜í•‘ ì‹œìŠ¤í…œ êµ¬í˜„
- ë¸Œë¼ìš°ì € í’€ ë§¤ë‹ˆì €ë¥¼ í†µí•œ ë¦¬ì†ŒìŠ¤ ê´€ë¦¬
- ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ê³¼ ë°ì´í„° ì¶”ì¶œ ê¸°ë²•
- ëŒ€ìš©ëŸ‰ í¬ë¡¤ë§ì„ ìœ„í•œ ì„±ëŠ¥ ìµœì í™”

### ì‹¤ë¬´ ì—­ëŸ‰
- ì‹¤ì œ ì›¹ì‚¬ì´íŠ¸ì˜ ë™ì  ì½˜í…ì¸  ìˆ˜ì§‘
- ë¸Œë¼ìš°ì € ì¸ìŠ¤í„´ìŠ¤ì˜ íš¨ìœ¨ì  ê´€ë¦¬
- ì—ëŸ¬ ì²˜ë¦¬ì™€ ë³µêµ¬ ë©”ì»¤ë‹ˆì¦˜ ì„¤ê³„
- ë ˆì´íŠ¸ ë¦¬ë¯¸íŒ…ê³¼ ì˜ˆì˜ë°”ë¥¸ í¬ë¡¤ë§

---

## ğŸ“š ì´ë¡  í•™ìŠµ

### 1. ì›¹ ìŠ¤í¬ë˜í•‘ì˜ ì§„í™”

#### ì „í†µì  ë°©ì‹ì˜ í•œê³„
```javascript
// ê¸°ì¡´ ë°©ì‹ - ì •ì  HTML íŒŒì‹±
const axios = require('axios');
const cheerio = require('cheerio');

async function oldWayScaping(url) {
  const response = await axios.get(url);
  const $ = cheerio.load(response.data);
  // ë™ì  ì½˜í…ì¸ ëŠ” ìˆ˜ì§‘ ë¶ˆê°€ëŠ¥
  return $('.content').text();
}
```

#### í˜„ëŒ€ì  ì ‘ê·¼ë²• - ë¸Œë¼ìš°ì € ìë™í™”
```typescript
// Playwrightë¥¼ í™œìš©í•œ ë™ì  ì½˜í…ì¸  ìˆ˜ì§‘
const { chromium } = require('playwright');

async function modernScraping(url: string) {
  const browser = await chromium.launch();
  const page = await browser.newPage();
  
  await page.goto(url);
  await page.waitForSelector('.dynamic-content'); // ë™ì  ë¡œë”© ëŒ€ê¸°
  
  const data = await page.evaluate(() => {
    // ë¸Œë¼ìš°ì € ë‚´ë¶€ì—ì„œ JavaScript ì‹¤í–‰
    return document.querySelector('.dynamic-content')?.textContent;
  });
  
  await browser.close();
  return data;
}
```

### 2. ë¸Œë¼ìš°ì € í’€ ë§¤ë‹ˆì €ì˜ í•„ìš”ì„±

#### ë¦¬ì†ŒìŠ¤ ê´€ë¦¬ ë¬¸ì œ
- **ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰**: ê° ë¸Œë¼ìš°ì € ì¸ìŠ¤í„´ìŠ¤ëŠ” 100-200MB ì‚¬ìš©
- **ì‹œì‘ ì‹œê°„**: ë¸Œë¼ìš°ì € ì´ˆê¸°í™”ì— 2-5ì´ˆ ì†Œìš”
- **ë™ì‹œì„± ì œí•œ**: OSë³„ í”„ë¡œì„¸ìŠ¤ ìˆ˜ ì œí•œ

#### í’€ë§ íŒ¨í„´ì˜ ì¥ì 
```typescript
// ë¸Œë¼ìš°ì € í’€ ë§¤ë‹ˆì € ê°œë…
interface BrowserPool {
  getAvailableInstance(): BrowserInstance;
  releaseInstance(instance: BrowserInstance): void;
  adjustPoolSize(requiredSize: number): Promise<void>;
}
```

---

## ğŸ” ì½”ë“œ ë¶„ì„

### 1. BrowserPoolManager ì•„í‚¤í…ì²˜

#### í•µì‹¬ ì¸í„°í˜ì´ìŠ¤ ì •ì˜
```typescript
export interface BrowserInstance {
  id: string;                    // ê³ ìœ  ì‹ë³„ì
  browser: Browser;             // Playwright Browser ì¸ìŠ¤í„´ìŠ¤
  context: BrowserContext;      // ë¸Œë¼ìš°ì € ì»¨í…ìŠ¤íŠ¸
  isActive: boolean;           // ì‚¬ìš© ì¤‘ ì—¬ë¶€
  assignedEntity?: string;     // í• ë‹¹ëœ ì‘ì—… ì‹ë³„ì
  lastUsed: number;           // ë§ˆì§€ë§‰ ì‚¬ìš© ì‹œê°„
  errorCount: number;         // ì—ëŸ¬ ë°œìƒ íšŸìˆ˜
}

export interface PoolConfig {
  maxInstances: number;       // ìµœëŒ€ ì¸ìŠ¤í„´ìŠ¤ ìˆ˜
  minInstances: number;       // ìµœì†Œ ì¸ìŠ¤í„´ìŠ¤ ìˆ˜
  entityType: 'cafe' | 'weverse';
  persistentDataPath: string; // ë°ì´í„° ì €ì¥ ê²½ë¡œ
}
```

#### ë™ì  í’€ ì¡°ì • ë©”ì»¤ë‹ˆì¦˜
```typescript
/**
 * í•„ìš”í•œ ë¸Œë¼ìš°ì € ì¸ìŠ¤í„´ìŠ¤ ìˆ˜ ê³„ì‚°
 */
private async calculateRequiredInstances(): Promise<{ cafe: number; weverse: number }> {
  const cafeCount = await this.getActiveCafeStreamerCount();
  const weverseCount = await this.getActiveWeverseArtistCount();

  return {
    cafe: Math.min(Math.max(cafeCount, this.CONFIG.cafe.minInstances), this.CONFIG.cafe.maxInstances),
    weverse: Math.min(Math.max(weverseCount, this.CONFIG.weverse.minInstances), this.CONFIG.weverse.maxInstances)
  };
}

/**
 * ë¸Œë¼ìš°ì € í’€ ë™ì  ì¡°ì •
 */
async adjustBrowserPools(): Promise<void> {
  if (this.poolAdjustmentInProgress) {
    console.log('â³ Browser pool adjustment already in progress, skipping...');
    return;
  }

  this.poolAdjustmentInProgress = true;
  
  try {
    const required = await this.calculateRequiredInstances();
    
    console.log(`ğŸ“Š Required browser instances - Cafe: ${required.cafe}, Weverse: ${required.weverse}`);
    console.log(`ğŸ“Š Current browser instances - Cafe: ${this.cafeBrowsers.length}, Weverse: ${this.weverseBrowsers.length}`);

    // ì¹´í˜ ë¸Œë¼ìš°ì € í’€ ì¡°ì •
    await this.adjustPool('cafe', required.cafe);
    
    // ìœ„ë²„ìŠ¤ ë¸Œë¼ìš°ì € í’€ ì¡°ì •
    await this.adjustPool('weverse', required.weverse);

    console.log(`âœ… Browser pool adjustment completed - Cafe: ${this.cafeBrowsers.length}, Weverse: ${this.weverseBrowsers.length}`);
    
  } catch (error) {
    console.error('âŒ Failed to adjust browser pools:', error);
  } finally {
    this.poolAdjustmentInProgress = false;
  }
}
```

### 2. ë¸Œë¼ìš°ì € ì¸ìŠ¤í„´ìŠ¤ ìƒì„±ê³¼ ê´€ë¦¬

#### ìµœì í™”ëœ ë¸Œë¼ìš°ì € ì„¤ì •
```typescript
private async createBrowserInstance(platform: 'cafe' | 'weverse'): Promise<BrowserInstance> {
  const config = this.CONFIG[platform];
  const instanceId = `${platform}_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
  
  try {
    console.log(`ğŸš€ Creating ${platform} browser instance: ${instanceId}`);

    const browser = await chromium.launch({
      headless: true,
      args: [
        '--no-sandbox',                    // ìƒŒë“œë°•ìŠ¤ ë¹„í™œì„±í™”
        '--disable-setuid-sandbox',
        '--disable-dev-shm-usage',         // /dev/shm ì‚¬ìš© ë¹„í™œì„±í™”
        '--disable-accelerated-2d-canvas', // 2D ìº”ë²„ìŠ¤ ê°€ì† ë¹„í™œì„±í™”
        '--no-first-run',                  // ì²« ì‹¤í–‰ ì„¤ì • ìŠ¤í‚µ
        '--no-zygote',                     // Zygote í”„ë¡œì„¸ìŠ¤ ë¹„í™œì„±í™”
        '--disable-gpu',                   // GPU ì‚¬ìš© ë¹„í™œì„±í™”
        '--disable-web-security',          // ì›¹ ë³´ì•ˆ ë¹„í™œì„±í™”
        '--disable-features=VizDisplayCompositor' // ë””ìŠ¤í”Œë ˆì´ ì»´í¬ì§€í„° ë¹„í™œì„±í™”
      ]
    });

    const context = await browser.newContext({
      userAgent: 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36',
      viewport: { width: 1920, height: 1080 }
    });

    // ìë™í™” ê°ì§€ ë°©ì§€
    await context.addInitScript(() => {
      Object.defineProperty(navigator, 'webdriver', {
        get: () => undefined,
      });
      delete (navigator as any).__proto__.webdriver;
    });

    const browserInstance: BrowserInstance = {
      id: instanceId,
      browser,
      context,
      isActive: false,
      lastUsed: Date.now(),
      errorCount: 0
    };

    console.log(`âœ… ${platform} browser instance created: ${instanceId}`);
    return browserInstance;

  } catch (error) {
    console.error(`âŒ Failed to create ${platform} browser instance:`, error);
    throw error;
  }
}
```

#### ë¼ìš´ë“œ ë¡œë¹ˆ ì¸ìŠ¤í„´ìŠ¤ í• ë‹¹
```typescript
/**
 * ì‚¬ìš© ê°€ëŠ¥í•œ ë¸Œë¼ìš°ì € ì¸ìŠ¤í„´ìŠ¤ ê°€ì ¸ì˜¤ê¸° (ë¼ìš´ë“œ ë¡œë¹ˆ)
 */
getAvailableBrowserInstance(platform: 'cafe' | 'weverse'): BrowserInstance | null {
  const pool = platform === 'cafe' ? this.cafeBrowsers : this.weverseBrowsers;
  
  // ì‚¬ìš© ì¤‘ì´ ì•„ë‹Œ ë¸Œë¼ìš°ì € ì¤‘ì—ì„œ ê°€ì¥ ì˜¤ë˜ ì‚¬ìš©ë˜ì§€ ì•Šì€ ê²ƒ ì„ íƒ
  const availableInstances = pool
    .filter(instance => !instance.isActive)
    .sort((a, b) => a.lastUsed - b.lastUsed);

  if (availableInstances.length > 0) {
    const instance = availableInstances[0];
    instance.isActive = true;
    instance.lastUsed = Date.now();
    return instance;
  }

  return null;
}

/**
 * ë¸Œë¼ìš°ì € ì¸ìŠ¤í„´ìŠ¤ ì‚¬ìš© ì™„ë£Œ ì²˜ë¦¬
 */
releaseBrowserInstance(instanceId: string): void {
  const allInstances = [...this.cafeBrowsers, ...this.weverseBrowsers];
  const instance = allInstances.find(inst => inst.id === instanceId);
  
  if (instance) {
    instance.isActive = false;
    instance.lastUsed = Date.now();
  }
}
```

### 3. WeiverseMonitorì˜ ê³ ê¸‰ ê¸°ë²•

#### ì¿ í‚¤ ìš°ì„ ìˆœìœ„ ê´€ë¦¬
```typescript
// ì¿ í‚¤ ê´€ë¦¬ ìƒìˆ˜ ì •ì˜
private static readonly CRITICAL_COOKIES = {
  // ìµœê³  ìš°ì„ ìˆœìœ„ - ì¸ì¦ í† í°
  HIGH_PRIORITY: [
    'we2_access_token',
    'we2_refresh_token',
    'access_token',
    'refresh_token'
  ],
  // ì¤‘ê°„ ìš°ì„ ìˆœìœ„ - ì„¸ì…˜ ê´€ë¦¬
  MEDIUM_PRIORITY: [
    'weverse_session',
    'session_id',
    'auth_token',
    'JSESSIONID'
  ],
  // ë‚®ì€ ìš°ì„ ìˆœìœ„ - ì‚¬ìš©ì ì„¤ì •
  LOW_PRIORITY: [
    'user_id',
    'user_settings',
    'locale',
    'timezone'
  ]
};
```

#### ì„¸ì…˜ ë¬´ê²°ì„± ê²€ì¦
```typescript
private async validateSessionIntegrity(): Promise<boolean> {
  if (!this.context) return false;
  
  try {
    // í˜„ì¬ ì¿ í‚¤ ìƒíƒœ í™•ì¸
    const cookies = await this.context.cookies();
    const criticalCookies = cookies.filter(cookie => 
      WeiverseMonitor.CRITICAL_COOKIES.HIGH_PRIORITY.includes(cookie.name)
    );
    
    if (criticalCookies.length === 0) {
      console.log('âŒ ì¤‘ìš” ì¸ì¦ ì¿ í‚¤ ì—†ìŒ - ì„¸ì…˜ ë¬´ê²°ì„± ì‹¤íŒ¨');
      return false;
    }
    
    // ë§Œë£Œëœ ì¿ í‚¤ í™•ì¸
    const now = Date.now() / 1000;
    const expiredCookies = criticalCookies.filter(cookie => 
      cookie.expires && cookie.expires < now
    );
    
    if (expiredCookies.length > 0) {
      console.log(`âŒ ${expiredCookies.length}ê°œ ë§Œë£Œëœ ì¿ í‚¤ ë°œê²¬ - ì„¸ì…˜ ë¬´ê²°ì„± ì‹¤íŒ¨`);
      return false;
    }
    
    console.log(`âœ… ì„¸ì…˜ ë¬´ê²°ì„± ê²€ì¦ ì„±ê³µ: ${criticalCookies.length}ê°œ ìœ íš¨í•œ ì¸ì¦ ì¿ í‚¤`);
    return true;
    
  } catch (error) {
    console.error('ì„¸ì…˜ ë¬´ê²°ì„± ê²€ì¦ ì‹¤íŒ¨:', error);
    return false;
  }
}
```

#### ìœ„ë²„ìŠ¤ ID ì¶”ì¶œ ë¡œì§
```typescript
/**
 * ìœ„ë²„ìŠ¤ URLì—ì„œ ê³ ìœ í•œ IDë¥¼ ì¶”ì¶œí•˜ëŠ” í•¨ìˆ˜
 */
private extractWeverseId(url: string): string {
  console.log(`[EXTRACT_ID] ğŸ” Extracting Weverse ID from URL: ${url}`);
  
  // ìœ„ë²„ìŠ¤ Live URL í˜•ì‹: /live/2-161749779 ë˜ëŠ” /live/2-161749779?params
  const liveMatch = url.match(/\/live\/([^?#]+)/);
  if (liveMatch) {
    console.log(`[EXTRACT_ID] âœ… Found Live ID: ${liveMatch[1]}`);
    return liveMatch[1];
  }
  
  // ìœ„ë²„ìŠ¤ ì¼ë°˜ ê²Œì‹œë¬¼ URL í˜•ì‹: /artist/2-161749779 ë˜ëŠ” /moment/2-161749779
  const postMatch = url.match(/\/(?:artist|moment|media)\/([^?#]+)/);
  if (postMatch) {
    console.log(`[EXTRACT_ID] âœ… Found Post ID: ${postMatch[1]}`);
    return postMatch[1];
  }
  
  // ìœ„ë²„ìŠ¤ ì•„í‹°ìŠ¤íŠ¸ í˜ì´ì§€ URL í˜•ì‹: /artistname/live/2-161749779
  const artistLiveMatch = url.match(/\/[^/]+\/live\/([^?#]+)/);
  if (artistLiveMatch) {
    console.log(`[EXTRACT_ID] âœ… Found Artist Live ID: ${artistLiveMatch[1]}`);
    return artistLiveMatch[1];
  }
  
  // ìœ„ë²„ìŠ¤ ì•„í‹°ìŠ¤íŠ¸ ê²Œì‹œë¬¼ URL í˜•ì‹: /artistname/artist/2-161749779
  const artistPostMatch = url.match(/\/[^/]+\/(?:artist|moment|media)\/([^?#]+)/);
  if (artistPostMatch) {
    console.log(`[EXTRACT_ID] âœ… Found Artist Post ID: ${artistPostMatch[1]}`);
    return artistPostMatch[1];
  }
  
  // ê¸°ì¡´ ë°©ì‹ (ìˆ«ìë§Œ ì¶”ì¶œ) - ë°±ì›Œë“œ í˜¸í™˜ì„±
  const numericMatch = url.match(/\/(\d+)(?:[?#]|$)/);
  if (numericMatch) {
    console.log(`[EXTRACT_ID] âœ… Found Numeric ID: ${numericMatch[1]}`);
    return numericMatch[1];
  }
  
  // ëª¨ë“  íŒ¨í„´ì´ ì‹¤íŒ¨í•˜ë©´ URL í•´ì‹œ ì‚¬ìš© (íƒ€ì„ìŠ¤íƒ¬í”„ ëŒ€ì‹ )
  const urlHash = crypto.createHash('md5').update(url).digest('hex').substring(0, 8);
  console.log(`[EXTRACT_ID] âš ï¸ No ID pattern matched, using URL hash: ${urlHash}`);
  return urlHash;
}
```

---

## ğŸ› ï¸ ì‹¤ìŠµ ì˜ˆì œ

### 1. ê¸°ë³¸ ë¸Œë¼ìš°ì € í’€ êµ¬í˜„

#### Step 1: ë¸Œë¼ìš°ì € ì¸ìŠ¤í„´ìŠ¤ ì¸í„°í˜ì´ìŠ¤ ì •ì˜
```typescript
// src/main/services/BrowserInstance.ts
interface SimpleBrowserInstance {
  id: string;
  browser: Browser;
  page: Page;
  isActive: boolean;
  createdAt: number;
  errorCount: number;
}

class SimpleBrowserPool {
  private instances: SimpleBrowserInstance[] = [];
  private maxInstances: number = 3;
  
  constructor(maxInstances: number = 3) {
    this.maxInstances = maxInstances;
  }
  
  async getAvailableInstance(): Promise<SimpleBrowserInstance> {
    // ì‚¬ìš© ê°€ëŠ¥í•œ ì¸ìŠ¤í„´ìŠ¤ ì°¾ê¸°
    let instance = this.instances.find(inst => !inst.isActive);
    
    if (!instance) {
      if (this.instances.length < this.maxInstances) {
        // ìƒˆ ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
        instance = await this.createInstance();
        this.instances.push(instance);
      } else {
        // ê°€ì¥ ì˜¤ë˜ëœ ì¸ìŠ¤í„´ìŠ¤ ì¬ì‚¬ìš©
        instance = this.instances.sort((a, b) => a.createdAt - b.createdAt)[0];
        await this.resetInstance(instance);
      }
    }
    
    instance.isActive = true;
    return instance;
  }
  
  private async createInstance(): Promise<SimpleBrowserInstance> {
    const browser = await chromium.launch({ headless: true });
    const page = await browser.newPage();
    
    return {
      id: `browser_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
      browser,
      page,
      isActive: false,
      createdAt: Date.now(),
      errorCount: 0
    };
  }
  
  private async resetInstance(instance: SimpleBrowserInstance): Promise<void> {
    try {
      await instance.page.close();
      instance.page = await instance.browser.newPage();
      instance.errorCount = 0;
    } catch (error) {
      console.error('Failed to reset browser instance:', error);
      instance.errorCount++;
    }
  }
  
  releaseInstance(instanceId: string): void {
    const instance = this.instances.find(inst => inst.id === instanceId);
    if (instance) {
      instance.isActive = false;
    }
  }
  
  async cleanup(): Promise<void> {
    for (const instance of this.instances) {
      try {
        await instance.browser.close();
      } catch (error) {
        console.error('Failed to close browser instance:', error);
      }
    }
    this.instances = [];
  }
}
```

#### Step 2: ë¸Œë¼ìš°ì € í’€ í™œìš© ì˜ˆì œ
```typescript
// src/main/services/WebScrapingService.ts
class WebScrapingService {
  private browserPool: SimpleBrowserPool;
  
  constructor() {
    this.browserPool = new SimpleBrowserPool(5);
  }
  
  async scrapeData(url: string): Promise<string> {
    const instance = await this.browserPool.getAvailableInstance();
    
    try {
      await instance.page.goto(url);
      await instance.page.waitForSelector('body');
      
      const data = await instance.page.evaluate(() => {
        // í˜ì´ì§€ì—ì„œ ë°ì´í„° ì¶”ì¶œ
        const title = document.querySelector('h1')?.textContent;
        const content = document.querySelector('.content')?.textContent;
        
        return JSON.stringify({
          title: title || '',
          content: content || '',
          timestamp: Date.now()
        });
      });
      
      return data;
      
    } catch (error) {
      console.error('Scraping failed:', error);
      throw error;
    } finally {
      this.browserPool.releaseInstance(instance.id);
    }
  }
}

// ì‚¬ìš© ì˜ˆì œ
const scraper = new WebScrapingService();

async function main() {
  try {
    const data = await scraper.scrapeData('https://example.com');
    console.log('Scraped data:', data);
  } catch (error) {
    console.error('Error:', error);
  }
}
```

### 2. ë™ì  ì½˜í…ì¸  ìˆ˜ì§‘ ì‹œìŠ¤í…œ

#### Step 1: ë™ì  ë¡œë”© ëŒ€ê¸° íŒ¨í„´
```typescript
// src/main/services/DynamicScraper.ts
class DynamicContentScraper {
  async scrapeWithWait(page: Page, url: string): Promise<any> {
    await page.goto(url, { waitUntil: 'networkidle' });
    
    // ë°©ë²• 1: íŠ¹ì • ìš”ì†Œê°€ ë‚˜íƒ€ë‚  ë•Œê¹Œì§€ ëŒ€ê¸°
    await page.waitForSelector('.dynamic-content', { timeout: 10000 });
    
    // ë°©ë²• 2: JavaScript ì‹¤í–‰ ì™„ë£Œê¹Œì§€ ëŒ€ê¸°
    await page.waitForFunction(() => {
      return window.document.readyState === 'complete';
    });
    
    // ë°©ë²• 3: íŠ¹ì • ì¡°ê±´ì´ ì¶©ì¡±ë  ë•Œê¹Œì§€ ëŒ€ê¸°
    await page.waitForFunction(() => {
      const elements = document.querySelectorAll('.item');
      return elements.length > 0;
    });
    
    // ë°ì´í„° ì¶”ì¶œ
    const data = await page.evaluate(() => {
      const items = Array.from(document.querySelectorAll('.item'));
      return items.map(item => ({
        title: item.querySelector('.title')?.textContent,
        content: item.querySelector('.content')?.textContent,
        timestamp: item.getAttribute('data-timestamp')
      }));
    });
    
    return data;
  }
}
```

#### Step 2: ë¬´í•œ ìŠ¤í¬ë¡¤ ì²˜ë¦¬
```typescript
async function scrapeInfiniteScroll(page: Page): Promise<any[]> {
  const allData: any[] = [];
  let previousHeight = 0;
  let currentHeight = await page.evaluate(() => document.body.scrollHeight);
  
  while (previousHeight !== currentHeight) {
    previousHeight = currentHeight;
    
    // í˜ì´ì§€ í•˜ë‹¨ìœ¼ë¡œ ìŠ¤í¬ë¡¤
    await page.evaluate(() => {
      window.scrollTo(0, document.body.scrollHeight);
    });
    
    // ìƒˆ ì½˜í…ì¸  ë¡œë”© ëŒ€ê¸°
    await page.waitForTimeout(2000);
    
    // í˜„ì¬ ë³´ì´ëŠ” í•­ëª©ë“¤ ìˆ˜ì§‘
    const newItems = await page.evaluate(() => {
      const items = Array.from(document.querySelectorAll('.new-item'));
      return items.map(item => ({
        id: item.getAttribute('data-id'),
        content: item.textContent
      }));
    });
    
    allData.push(...newItems);
    
    // ìƒˆë¡œìš´ ë†’ì´ í™•ì¸
    currentHeight = await page.evaluate(() => document.body.scrollHeight);
    
    // ì•ˆì „ ì¥ì¹˜: ìµœëŒ€ 10ë²ˆ ìŠ¤í¬ë¡¤
    if (allData.length > 1000) break;
  }
  
  return allData;
}
```

### 3. ì—ëŸ¬ ì²˜ë¦¬ì™€ ë³µêµ¬ ë©”ì»¤ë‹ˆì¦˜

#### Step 1: ì¬ì‹œë„ íŒ¨í„´
```typescript
class RobustScraper {
  async scrapeWithRetry(
    url: string,
    maxRetries: number = 3,
    delayMs: number = 1000
  ): Promise<any> {
    for (let attempt = 1; attempt <= maxRetries; attempt++) {
      try {
        console.log(`Scraping attempt ${attempt}/${maxRetries}`);
        
        const result = await this.performScraping(url);
        console.log(`âœ… Scraping succeeded on attempt ${attempt}`);
        return result;
        
      } catch (error) {
        console.error(`âŒ Scraping failed on attempt ${attempt}:`, error);
        
        if (attempt === maxRetries) {
          throw new Error(`ìŠ¤í¬ë˜í•‘ ì‹¤íŒ¨: ${maxRetries}ë²ˆ ì‹œë„ í›„ í¬ê¸°`);
        }
        
        // ì§€ìˆ˜ ë°±ì˜¤í”„ ì ìš©
        const delay = delayMs * Math.pow(2, attempt - 1);
        console.log(`â³ ${delay}ms ëŒ€ê¸° í›„ ì¬ì‹œë„...`);
        await this.delay(delay);
      }
    }
  }
  
  private async performScraping(url: string): Promise<any> {
    const instance = await this.browserPool.getAvailableInstance();
    
    try {
      // íƒ€ì„ì•„ì›ƒ ì„¤ì •
      instance.page.setDefaultTimeout(15000);
      
      await instance.page.goto(url);
      
      // í˜ì´ì§€ ë¡œë”© í™•ì¸
      await instance.page.waitForLoadState('networkidle');
      
      // ë°ì´í„° ì¶”ì¶œ
      const data = await instance.page.evaluate(() => {
        // ì‹¤ì œ ìŠ¤í¬ë˜í•‘ ë¡œì§
        return { success: true, data: 'ìˆ˜ì§‘ëœ ë°ì´í„°' };
      });
      
      return data;
      
    } finally {
      this.browserPool.releaseInstance(instance.id);
    }
  }
  
  private delay(ms: number): Promise<void> {
    return new Promise(resolve => setTimeout(resolve, ms));
  }
}
```

#### Step 2: ì„œí‚· ë¸Œë ˆì´ì»¤ íŒ¨í„´
```typescript
class CircuitBreaker {
  private failures: number = 0;
  private lastFailureTime: number = 0;
  private state: 'closed' | 'open' | 'half-open' = 'closed';
  
  constructor(
    private threshold: number = 5,
    private timeoutMs: number = 60000
  ) {}
  
  async execute<T>(fn: () => Promise<T>): Promise<T> {
    if (this.state === 'open') {
      if (Date.now() - this.lastFailureTime > this.timeoutMs) {
        this.state = 'half-open';
        console.log('ğŸ”„ Circuit breaker: half-open ìƒíƒœë¡œ ì „í™˜');
      } else {
        throw new Error('Circuit breaker is open');
      }
    }
    
    try {
      const result = await fn();
      
      if (this.state === 'half-open') {
        this.state = 'closed';
        this.failures = 0;
        console.log('âœ… Circuit breaker: closed ìƒíƒœë¡œ ë³µêµ¬');
      }
      
      return result;
      
    } catch (error) {
      this.failures++;
      this.lastFailureTime = Date.now();
      
      if (this.failures >= this.threshold) {
        this.state = 'open';
        console.log(`âŒ Circuit breaker: open ìƒíƒœë¡œ ì „í™˜ (${this.failures} ì‹¤íŒ¨)`);
      }
      
      throw error;
    }
  }
}
```

---

## ğŸ“‹ ê³¼ì œ

### ğŸ“ ê¸°ë³¸ ê³¼ì œ
1. **ë¸Œë¼ìš°ì € í’€ êµ¬í˜„**: ìµœëŒ€ 3ê°œ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ê´€ë¦¬í•˜ëŠ” ë¸Œë¼ìš°ì € í’€ í´ë˜ìŠ¤ êµ¬í˜„
2. **ë™ì  ì½˜í…ì¸  ìˆ˜ì§‘**: JavaScriptë¡œ ë™ì  ìƒì„±ë˜ëŠ” ì½˜í…ì¸ ë¥¼ ìˆ˜ì§‘í•˜ëŠ” ìŠ¤í¬ë˜í¼ êµ¬í˜„
3. **ì—ëŸ¬ ì²˜ë¦¬**: ì¬ì‹œë„ ë¡œì§ê³¼ íƒ€ì„ì•„ì›ƒ ì²˜ë¦¬ê°€ í¬í•¨ëœ ê²¬ê³ í•œ ìŠ¤í¬ë˜í•‘ ì‹œìŠ¤í…œ êµ¬í˜„

### ğŸš€ ì‘ìš© ê³¼ì œ
1. **ë ˆì´íŠ¸ ë¦¬ë¯¸íŒ…**: ìš”ì²­ ê°„ê²©ì„ ìë™ ì¡°ì ˆí•˜ëŠ” ìŠ¤í¬ë˜í•‘ ì‹œìŠ¤í…œ êµ¬í˜„
2. **ì„¸ì…˜ ê´€ë¦¬**: ë¡œê·¸ì¸ì´ í•„ìš”í•œ ì‚¬ì´íŠ¸ì˜ ì„¸ì…˜ì„ ìœ ì§€í•˜ëŠ” ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ êµ¬í˜„
3. **ë³‘ë ¬ ì²˜ë¦¬**: ì—¬ëŸ¬ í˜ì´ì§€ë¥¼ ë™ì‹œì— ëª¨ë‹ˆí„°ë§í•˜ëŠ” ì‹œìŠ¤í…œ êµ¬í˜„

### ğŸ’ª ë„ì „ ê³¼ì œ
1. **ì§€ëŠ¥í˜• í’€ ê´€ë¦¬**: ì‚¬ìš© íŒ¨í„´ì„ ë¶„ì„í•˜ì—¬ í’€ í¬ê¸°ë¥¼ ë™ì  ì¡°ì ˆí•˜ëŠ” ì‹œìŠ¤í…œ êµ¬í˜„
2. **í”„ë¡ì‹œ ë¡œí…Œì´ì…˜**: ì—¬ëŸ¬ í”„ë¡ì‹œë¥¼ ìˆœí™˜ ì‚¬ìš©í•˜ëŠ” ê³ ê¸‰ ìŠ¤í¬ë˜í•‘ ì‹œìŠ¤í…œ êµ¬í˜„
3. **ë¶„ì‚° ëª¨ë‹ˆí„°ë§**: ì—¬ëŸ¬ ë¸Œë¼ìš°ì € ì¸ìŠ¤í„´ìŠ¤ë¥¼ í™œìš©í•œ ë¶„ì‚° ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ êµ¬í˜„

---

## ğŸ“š ì¶”ê°€ í•™ìŠµ ìë£Œ

### ğŸ“– í•µì‹¬ ë¬¸ì„œ
- [Playwright ê³µì‹ ë¬¸ì„œ](https://playwright.dev/)
- [Browser Pool Pattern](https://docs.microsoft.com/en-us/azure/architecture/patterns/pool)
- [Web Scraping Best Practices](https://blog.apify.com/web-scraping-best-practices/)

### ğŸ› ï¸ ì‹¤ìŠµ ë¦¬ì†ŒìŠ¤
- [Playwright Examples](https://github.com/microsoft/playwright/tree/main/examples)
- [Anti-detection Techniques](https://github.com/berstend/puppeteer-extra/tree/master/packages/puppeteer-extra-plugin-stealth)
- [Crawling Ethics Guidelines](https://blog.apify.com/web-scraping-ethics/)

### ğŸ¯ í™•ì¥ í•™ìŠµ
- **Cluster ëª¨ë“œ**: ì—¬ëŸ¬ í”„ë¡œì„¸ìŠ¤ì—ì„œ ë¸Œë¼ìš°ì € í’€ ê³µìœ 
- **Redis ê¸°ë°˜ í**: ìŠ¤í¬ë˜í•‘ ì‘ì—…ì„ íë¡œ ê´€ë¦¬
- **ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ**: ìŠ¤í¬ë˜í•‘ ìƒíƒœë¥¼ ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§

---

## ğŸ’¡ í•µì‹¬ ì •ë¦¬

### âœ… í•™ìŠµ ì™„ë£Œ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] ë¸Œë¼ìš°ì € í’€ ë§¤ë‹ˆì €ì˜ ë™ì‘ ì›ë¦¬ ì´í•´
- [ ] ë™ì  ì½˜í…ì¸  ìˆ˜ì§‘ ê¸°ë²• ìŠµë“
- [ ] ì—ëŸ¬ ì²˜ë¦¬ì™€ ë³µêµ¬ ë©”ì»¤ë‹ˆì¦˜ êµ¬í˜„
- [ ] ì„±ëŠ¥ ìµœì í™” ê¸°ë²• ì ìš©
- [ ] ì˜ˆì˜ë°”ë¥¸ í¬ë¡¤ë§ ì›ì¹™ ì´í•´

### ğŸ¯ ë‹¤ìŒ ë‹¨ê³„ ë¯¸ë¦¬ë³´ê¸°
**12ì¼ì°¨**ì—ì„œëŠ” ì´ë ‡ê²Œ êµ¬ì¶•í•œ ì›¹ ìŠ¤í¬ë˜í•‘ ì‹œìŠ¤í…œì„ í™œìš©í•˜ì—¬ **ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ**ì„ êµ¬í˜„í•˜ê³ , ì´ë²¤íŠ¸ ê¸°ë°˜ ì•„í‚¤í…ì²˜ì™€ ì„±ëŠ¥ ìµœì í™”ì— ëŒ€í•´ ì‹¬ë„ìˆê²Œ í•™ìŠµí•©ë‹ˆë‹¤.

---

*ğŸš€ ì‹¤ì œ í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œ ì‚¬ìš©ë˜ëŠ” ë¸Œë¼ìš°ì € í’€ ê´€ë¦¬ì™€ ì›¹ ìŠ¤í¬ë˜í•‘ ê¸°ë²•ì„ ë§ˆìŠ¤í„°í–ˆìŠµë‹ˆë‹¤! ì´ì œ ëŒ€ìš©ëŸ‰ ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œì„ êµ¬ì¶•í•  ì¤€ë¹„ê°€ ë˜ì—ˆìŠµë‹ˆë‹¤.*