# 5ì¼ì°¨: Context Bridgeì™€ ë³´ì•ˆ ëª¨ë¸

## í•™ìŠµ ëª©í‘œ
- Electronì˜ ë³´ì•ˆ ëª¨ë¸ì„ ì™„ì „íˆ ì´í•´í•œë‹¤
- Context Isolationì˜ ë™ì‘ ì›ë¦¬ë¥¼ í•™ìŠµí•œë‹¤
- ë³´ì•ˆ ìœ„í—˜ìš”ì†Œì™€ ë°©ì–´ ê¸°ë²•ì„ íŒŒì•…í•œë‹¤
- ì•ˆì „í•œ API ì„¤ê³„ ì›ì¹™ì„ ìŠµë“í•œë‹¤

## ì´ë¡  í•™ìŠµ

### Electron ë³´ì•ˆ ëª¨ë¸ì˜ ì§„í™”

#### 1. ì´ˆê¸° Electron (ë³´ì•ˆ ìœ„í—˜)
```typescript
// âŒ ë§¤ìš° ìœ„í—˜í•œ ì„¤ì •
new BrowserWindow({
  webPreferences: {
    nodeIntegration: true,        // Node.js ì§ì ‘ ì ‘ê·¼ í—ˆìš©
    contextIsolation: false,      // ì»¨í…ìŠ¤íŠ¸ ê²©ë¦¬ ë¹„í™œì„±í™”
    enableRemoteModule: true      // ì›ê²© ëª¨ë“ˆ í™œì„±í™”
  }
});
```

**ë¬¸ì œì :**
- **ë¬´ì œí•œ ì‹œìŠ¤í…œ ì ‘ê·¼**: ì›¹ í˜ì´ì§€ì—ì„œ ì§ì ‘ íŒŒì¼ ì‹œìŠ¤í…œ ì ‘ê·¼
- **ì½”ë“œ ì¸ì ì…˜**: ì•…ì„± ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ ê°€ëŠ¥
- **ì›ê²© ì½”ë“œ ì‹¤í–‰**: ì™¸ë¶€ì—ì„œ ì‹œìŠ¤í…œ ëª…ë ¹ ì‹¤í–‰ ê°€ëŠ¥

#### 2. í˜„ëŒ€ Electron (ë³´ì•ˆ ê°•í™”)
```typescript
// âœ… ì•ˆì „í•œ ì„¤ì •
new BrowserWindow({
  webPreferences: {
    nodeIntegration: false,       // Node.js ì§ì ‘ ì ‘ê·¼ ì°¨ë‹¨
    contextIsolation: true,       // ì»¨í…ìŠ¤íŠ¸ ê²©ë¦¬ í™œì„±í™”
    preload: path.join(__dirname, 'preload.js'),  // ì•ˆì „í•œ API ë…¸ì¶œ
    sandbox: false                // ìƒŒë“œë°•ìŠ¤ (í•„ìš”ì‹œ)
  }
});
```

### Context Isolation ë™ì‘ ì›ë¦¬

#### 1. ì»¨í…ìŠ¤íŠ¸ ë¶„ë¦¬ êµ¬ì¡°
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Renderer Process              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Main World    â”‚    Isolated World     â”‚
â”‚                 â”‚                       â”‚
â”‚ â€¢ ì›¹ í˜ì´ì§€ ì½”ë“œâ”‚ â€¢ Preload ìŠ¤í¬ë¦½íŠ¸    â”‚
â”‚ â€¢ DOM API       â”‚ â€¢ Node.js API ì œí•œ   â”‚
â”‚ â€¢ ë¸Œë¼ìš°ì € API  â”‚ â€¢ Context Bridge     â”‚
â”‚ â€¢ ì œí•œëœ ê¶Œí•œ   â”‚ â€¢ ì•ˆì „í•œ í†µì‹  ì±„ë„    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2. Context Bridgeì˜ ì—­í• 
```typescript
// Isolated World (preload.ts)
contextBridge.exposeInMainWorld('electronAPI', {
  safeAPI: (data) => {
    // ì…ë ¥ ê²€ì¦
    if (typeof data !== 'string') {
      throw new Error('Invalid input type');
    }
    
    // ê¸¸ì´ ì œí•œ
    if (data.length > 1000) {
      throw new Error('Input too long');
    }
    
    // ì•ˆì „í•œ IPC í˜¸ì¶œ
    return ipcRenderer.invoke('safe-operation', data);
  }
});

// Main World (renderer)
window.electronAPI.safeAPI('safe data'); // âœ… ì•ˆì „í•œ í˜¸ì¶œ
```

### ë³´ì•ˆ ìœ„í—˜ìš”ì†Œì™€ ë°©ì–´ ê¸°ë²•

#### 1. XSS (Cross-Site Scripting) ë°©ì–´

**ìœ„í—˜ ì‹œë‚˜ë¦¬ì˜¤:**
```typescript
// âŒ ìœ„í—˜í•œ ì½”ë“œ
const userInput = '<script>window.electronAPI.deleteAllFiles()</script>';
document.innerHTML = userInput;  // XSS ê³µê²© ê°€ëŠ¥
```

**ë°©ì–´ ê¸°ë²•:**
```typescript
// âœ… ì•ˆì „í•œ ì½”ë“œ
const userInput = '<script>alert("XSS")</script>';
const safeContent = DOMPurify.sanitize(userInput);  // ì…ë ¥ ì •í™”
document.innerHTML = safeContent;

// ë˜ëŠ” textContent ì‚¬ìš©
element.textContent = userInput;  // HTML í•´ì„ ë°©ì§€
```

#### 2. Path Traversal ê³µê²© ë°©ì–´

**ìœ„í—˜ ì‹œë‚˜ë¦¬ì˜¤:**
```typescript
// âŒ ìœ„í—˜í•œ ì½”ë“œ (Main Process)
ipcMain.handle('read-file', async (_, filePath) => {
  // '../../../etc/passwd' ê°™ì€ ê²½ë¡œë¡œ ì‹œìŠ¤í…œ íŒŒì¼ ì ‘ê·¼ ê°€ëŠ¥
  return fs.readFileSync(filePath, 'utf8');
});
```

**ë°©ì–´ ê¸°ë²•:**
```typescript
// âœ… ì•ˆì „í•œ ì½”ë“œ (Main Process)
ipcMain.handle('read-file', async (_, filePath) => {
  const allowedDir = path.join(__dirname, 'safe-files');
  const fullPath = path.resolve(allowedDir, filePath);
  
  // í—ˆìš©ëœ ë””ë ‰í† ë¦¬ ì™¸ë¶€ ì ‘ê·¼ ì°¨ë‹¨
  if (!fullPath.startsWith(allowedDir)) {
    throw new Error('Access denied: Path outside allowed directory');
  }
  
  // íŒŒì¼ ì¡´ì¬ í™•ì¸
  if (!fs.existsSync(fullPath)) {
    throw new Error('File not found');
  }
  
  return fs.readFileSync(fullPath, 'utf8');
});
```#### 3. ì…ë ¥ ê²€ì¦ ë° ë°ì´í„° ì •í™”

**í”„ë¡œì íŠ¸ ì‚¬ë¡€ ë¶„ì„:**
```typescript
// preload.tsì—ì„œì˜ ì…ë ¥ ê²€ì¦ ì˜ˆì‹œ
addStreamer: (streamerData: any) => {
  // íƒ€ì… ê²€ì¦
  if (!streamerData || typeof streamerData !== 'object') {
    throw new Error('Invalid streamer data');
  }
  
  // í•„ìˆ˜ í•„ë“œ ê²€ì¦
  if (!streamerData.name || typeof streamerData.name !== 'string') {
    throw new Error('Streamer name is required');
  }
  
  // ê¸¸ì´ ì œí•œ
  if (streamerData.name.length > 50) {
    throw new Error('Streamer name too long');
  }
  
  // HTML/ìŠ¤í¬ë¦½íŠ¸ ì œê±°
  const cleanData = {
    name: DOMPurify.sanitize(streamerData.name),
    chzzkId: streamerData.chzzkId ? String(streamerData.chzzkId) : null,
    isActive: Boolean(streamerData.isActive)
  };
  
  return ipcRenderer.invoke('add-streamer', cleanData);
}
```

### ìš°ë¦¬ í”„ë¡œì íŠ¸ì˜ ë³´ì•ˆ êµ¬í˜„ ë¶„ì„

#### 1. ë³´ì•ˆ ì„¤ì • ê²€í† 
```typescript
// main.tsì˜ BrowserWindow ì„¤ì •
webPreferences: {
  nodeIntegration: false,        // âœ… Node.js ì§ì ‘ ì ‘ê·¼ ì°¨ë‹¨
  contextIsolation: true,        // âœ… ì»¨í…ìŠ¤íŠ¸ ê²©ë¦¬ í™œì„±í™”
  preload: path.join(__dirname, 'preload.js'), // âœ… ì•ˆì „í•œ API ë…¸ì¶œ
  // sandbox: false              // â“ ìƒŒë“œë°•ìŠ¤ ê³ ë ¤í•´ë³¼ ìˆ˜ ìˆìŒ
}
```

#### 2. API ë…¸ì¶œ íŒ¨í„´ ë¶„ì„
```typescript
// preload.tsì˜ ì•ˆì „í•œ API ë…¸ì¶œ
contextBridge.exposeInMainWorld('electronAPI', electronAPI);

// ê°œë°œì ë„êµ¬ í•¨ìˆ˜ë„ ì•ˆì „í•˜ê²Œ ë…¸ì¶œ
contextBridge.exposeInMainWorld('clearWeverseData', async () => {
  console.log('ğŸ§¹ ìœ„ë²„ìŠ¤ ì•Œë¦¼ ë°ì´í„° í´ë¦¬ì–´ ì¤‘...');
  try {
    const result = await electronAPI.clearWeverseData();
    // ê²°ê³¼ ê²€ì¦ ë° ì•ˆì „í•œ ë°˜í™˜
    return result;
  } catch (error) {
    // ì—ëŸ¬ ì •í™” í›„ ë°˜í™˜
    return { success: false, error: String(error) };
  }
});
```

**ë³´ì•ˆ ì¥ì :**
- **ëª…ì‹œì  API**: í•„ìš”í•œ ê¸°ëŠ¥ë§Œ ì„ ë³„ì  ë…¸ì¶œ
- **ì—ëŸ¬ ì •í™”**: ì‹œìŠ¤í…œ ì •ë³´ ë…¸ì¶œ ë°©ì§€
- **ë¡œê¹… í†µí•©**: ë³´ì•ˆ ì´ë²¤íŠ¸ ì¶”ì  ê°€ëŠ¥

## ì‹¤ìŠµ ì˜ˆì œ

### ì‹¤ìŠµ 1: ë³´ì•ˆ ì„¤ì • ë¹„êµ í…ŒìŠ¤íŠ¸

1. **í˜„ì¬ ë³´ì•ˆ ì„¤ì • í™•ì¸:**
```javascript
// ê°œë°œì ì½˜ì†”ì—ì„œ ì‹¤í–‰
console.log('Node integration:', window.process === undefined); // trueì—¬ì•¼ í•¨
console.log('Context isolation:', window.electronAPI !== undefined); // trueì—¬ì•¼ í•¨

// ìœ„í—˜í•œ API ì ‘ê·¼ ì‹œë„
try {
  require('fs'); // Error ë°œìƒí•´ì•¼ í•¨
} catch (e) {
  console.log('âœ… Node.js direct access blocked:', e.message);
}
```

### ì‹¤ìŠµ 2: ì…ë ¥ ê²€ì¦ í…ŒìŠ¤íŠ¸

1. **ì •ìƒ ë°ì´í„°ë¡œ API í˜¸ì¶œ:**
```javascript
await window.electronAPI.addStreamer({
  name: 'Test Streamer',
  chzzkId: 'test123',
  isActive: true
});
```

2. **ë¹„ì •ìƒ ë°ì´í„°ë¡œ ë³´ì•ˆ í…ŒìŠ¤íŠ¸:**
```javascript
// XSS ì‹œë„
await window.electronAPI.addStreamer({
  name: '<script>alert("XSS")</script>',
  chzzkId: 'test123'
});

// SQL Injection ì‹œë„  
await window.electronAPI.addStreamer({
  name: "'; DROP TABLE streamers; --",
  chzzkId: 'test123'
});

// ê³¼ë„í•œ ë°ì´í„° ì „ì†¡
await window.electronAPI.addStreamer({
  name: 'A'.repeat(10000), // ë§¤ìš° ê¸´ ë¬¸ìì—´
  chzzkId: 'test123'
});
```

### ì‹¤ìŠµ 3: Context Isolation í™•ì¸

1. **Main Worldì™€ Isolated World ë¶„ë¦¬ í™•ì¸:**
```javascript
// ê°œë°œì ì½˜ì†”ì—ì„œ í™•ì¸
console.log('window object keys:', Object.keys(window));
console.log('electronAPI available:', typeof window.electronAPI);

// preloadì—ì„œ ì„¤ì •í•œ ë³€ìˆ˜ë“¤ í™•ì¸
console.log('Custom APIs:', {
  clearWeverseData: typeof window.clearWeverseData,
  diagnosticWeverseDatabase: typeof window.diagnosticWeverseDatabase
});
```

## ê³¼ì œ

### ê³¼ì œ 1: ë³´ì•ˆ ì·¨ì•½ì  ë¶„ì„

ë‹¤ìŒ ì½”ë“œë“¤ì˜ ë³´ì•ˆ ì·¨ì•½ì ì„ ì°¾ê³  ê°œì„  ë°©ì•ˆì„ ì œì‹œí•˜ì„¸ìš”:

**ì½”ë“œ A:**
```typescript
// Main Process
ipcMain.handle('execute-command', async (_, command) => {
  const { exec } = require('child_process');
  return new Promise((resolve, reject) => {
    exec(command, (error, stdout, stderr) => {
      if (error) reject(error);
      else resolve(stdout);
    });
  });
});
```

**ì½”ë“œ B:**
```typescript
// Preload Script
contextBridge.exposeInMainWorld('fileAPI', {
  readAnyFile: (path) => ipcRenderer.invoke('read-file', path),
  writeAnyFile: (path, content) => ipcRenderer.invoke('write-file', path, content)
});
```

**ì½”ë“œ C:**
```typescript
// Renderer Process
const userInput = document.getElementById('input').value;
document.getElementById('output').innerHTML = userInput;
```

### ê³¼ì œ 2: ì•ˆì „í•œ íŒŒì¼ ê´€ë¦¬ API ì„¤ê³„

ë‹¤ìŒ ìš”êµ¬ì‚¬í•­ì„ ë§Œì¡±í•˜ëŠ” ì•ˆì „í•œ íŒŒì¼ APIë¥¼ ì„¤ê³„í•˜ì„¸ìš”:

**ìš”êµ¬ì‚¬í•­:**
- ì‚¬ìš©ì ë¬¸ì„œ í´ë” ë‚´ì—ì„œë§Œ ì‘ì—… ê°€ëŠ¥
- ì‹¤í–‰ íŒŒì¼(.exe, .bat ë“±) ì²˜ë¦¬ ê¸ˆì§€
- íŒŒì¼ í¬ê¸° ì œí•œ (10MB)
- ê²½ë¡œ ê²€ì¦ ë° ì •í™”

```typescript
// ì—¬ëŸ¬ë¶„ì˜ ì„¤ê³„ì•ˆì„ ì‘ì„±í•´ë³´ì„¸ìš”
const safeFileAPI = {
  readUserFile: (filename: string) => {
    // êµ¬í˜„í•´ë³´ì„¸ìš”
  },
  writeUserFile: (filename: string, content: string) => {
    // êµ¬í˜„í•´ë³´ì„¸ìš”  
  },
  listUserFiles: () => {
    // êµ¬í˜„í•´ë³´ì„¸ìš”
  }
};
```

### ê³¼ì œ 3: XSS ë°©ì–´ ì‹œìŠ¤í…œ êµ¬í˜„

ë‹¤ìŒê³¼ ê°™ì€ ì‚¬ìš©ì ì…ë ¥ ì²˜ë¦¬ í•¨ìˆ˜ë¥¼ ì•ˆì „í•˜ê²Œ êµ¬í˜„í•˜ì„¸ìš”:

```typescript
// ìš”êµ¬ì‚¬í•­:
// 1. HTML íƒœê·¸ ì œê±°
// 2. ìŠ¤í¬ë¦½íŠ¸ ì½”ë“œ ì°¨ë‹¨  
// 3. ê¸¸ì´ ì œí•œ ì ìš©
// 4. íŠ¹ìˆ˜ ë¬¸ì ì´ìŠ¤ì¼€ì´í”„

function sanitizeUserInput(input: string): string {
  // ì—¬ëŸ¬ë¶„ì˜ êµ¬í˜„
}

// í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤
const testCases = [
  '<script>alert("XSS")</script>',
  '<img src="x" onerror="alert(1)">',
  'Normal text content',
  '&lt;safe&gt; content',
  'Very long text...'.repeat(1000)
];
```

### ê³¼ì œ 4: ì‹¤ìŠµ - ë³´ì•ˆ ê°ì‚¬ ì²´í¬ë¦¬ìŠ¤íŠ¸

ìš°ë¦¬ í”„ë¡œì íŠ¸ì˜ ë³´ì•ˆ ìƒíƒœë¥¼ ì ê²€í•˜ëŠ” ì²´í¬ë¦¬ìŠ¤íŠ¸ë¥¼ ì‘ì„±í•˜ê³  ì‹¤ì œë¡œ ê²€ì‚¬í•´ë³´ì„¸ìš”:

**ì²´í¬ë¦¬ìŠ¤íŠ¸ ì˜ˆì‹œ:**
- [ ] nodeIntegrationì´ falseë¡œ ì„¤ì •ë˜ì–´ ìˆëŠ”ê°€?
- [ ] contextIsolationì´ trueë¡œ ì„¤ì •ë˜ì–´ ìˆëŠ”ê°€?
- [ ] ëª¨ë“  IPC í•¸ë“¤ëŸ¬ì— ì…ë ¥ ê²€ì¦ì´ ìˆëŠ”ê°€?
- [ ] íŒŒì¼ ê²½ë¡œì— ëŒ€í•œ ì ‘ê·¼ ì œì–´ê°€ ìˆëŠ”ê°€?
- [ ] ì‚¬ìš©ì ì…ë ¥ì— ëŒ€í•œ XSS ë°©ì–´ê°€ ìˆëŠ”ê°€?
- [ ] ì—ëŸ¬ ë©”ì‹œì§€ì— ì‹œìŠ¤í…œ ì •ë³´ê°€ ë…¸ì¶œë˜ì§€ ì•ŠëŠ”ê°€?

## ì¶”ê°€ í•™ìŠµ ìë£Œ

### Electron ë³´ì•ˆ
- [Electron Security Guidelines](https://www.electronjs.org/docs/latest/tutorial/security)
- [Security Best Practices](https://www.electronjs.org/docs/latest/tutorial/security#security-recommendations)
- [Context Isolation Deep Dive](https://www.electronjs.org/docs/latest/tutorial/context-isolation)

### ì›¹ ë³´ì•ˆ ê¸°ì´ˆ
- [OWASP Top 10](https://owasp.org/www-project-top-ten/)
- [XSS Prevention Cheat Sheet](https://cheatsheetseries.owasp.org/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.html)

### ë‹¤ìŒ í•™ìŠµ ì˜ˆê³ 
**6ì¼ì°¨ì—ì„œëŠ” ë¹Œë“œ ì‹œìŠ¤í…œê³¼ Webpack ì„¤ì •ì„ í•™ìŠµí•©ë‹ˆë‹¤. ê°œë°œ í™˜ê²½ê³¼ í”„ë¡œë•ì…˜ í™˜ê²½ì˜ ì°¨ì´, ìµœì í™” ê¸°ë²•, ê·¸ë¦¬ê³  Hot Module Replacementì— ëŒ€í•´ ì•Œì•„ë´…ë‹ˆë‹¤.**

---
*ğŸ¯ í•™ìŠµ íŒ: ë³´ì•ˆì€ í•œ ë²ˆ ì„¤ì •í•˜ê³  ëë‚˜ëŠ” ê²ƒì´ ì•„ë‹™ë‹ˆë‹¤. ì§€ì†ì ì¸ ê²€í† ì™€ ì—…ë°ì´íŠ¸ê°€ í•„ìš”í•˜ë©°, ëª¨ë“  ì…ë ¥ì„ ì˜ì‹¬í•˜ëŠ” ìŠµê´€ì„ ê¸°ë¥´ëŠ” ê²ƒì´ ì¤‘ìš”í•´ìš”!*